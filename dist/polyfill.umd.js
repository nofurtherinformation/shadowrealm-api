/**
 * shadowrealm-api@0.8.2
 * ShadowRealm polyfill for browser
 * @author Ambit Tsai <ambit_tsai@qq.com>
 * @license Apache-2.0
 * @see {@link https://github.com/ambit-tsai/shadowrealm-api#readme}
 */
!function(r){"function"==typeof define&&define.amd?define(r):r()}((function(){"use strict";var r,e=window,t=Object.defineProperty,n={debug:!1},a=console.log,o=console.warn;function i(r){n.debug&&(a("[DEBUG]"),l(r)?o(r):a(r))}if(e.Reflect)r=Reflect.apply;else{var s=Function.prototype.apply;r=function(r,e,t){return s.call(r,e,t)}}var u=String.prototype.replace;function l(r){return!!r&&"object"==typeof r}var c=Object.assign,f=Object.keys;function p(){var r,e=params,t=e[0],n=e[1],a=e[2],o=e[3];try{for(var i=arguments,s=[],u=0,l=i.length;u<l;++u){var c=o.getWrappedValue(a,i[u],t,o);s.push(c)}r=o.apply(n,a.globalObject,s)}catch(r){throw o.wrapError(r,t)}return o.getWrappedValue(t,r,a,o)}c||(c=function(r){for(var e=arguments,t=1,n=e.length;t<n;++t){var a=e[t];if(l(a))for(var o=0,i=f(a);o<i.length;o++){var s=i[o];r[s]=a[s]}}return r});var g=Object.freeze({__proto__:null,GLOBAL:e,define:t,_:n,log:i,get apply(){return r},replace:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(u,e,t)},isObject:l,get assign(){return c},keys:f,wrapError:function(r,e,t){var n=e.intrinsics;if(void 0===t&&(t=!1),i(r),t){if(!r._)return new n[r.name](r.message);r=r._}var a=n.TypeError,o="Cross-Realm Error: ";return l(r)?new a(o+r.name+": "+r.message):new a(o+r)},getWrappedValue:function(r,e,n,a){if("function"==typeof e)try{return function createWrappedFunction(r,e,n,a){var o=e.length,i=e.name;("number"!=typeof o||o<0)&&(o=0);"string"!=typeof i&&(i="");var s=r.intrinsics.Function("params","return "+p.toString())(arguments);return t(s,"length",{value:o}),t(s,"name",{value:i}),s}(r,e,n,a)}catch(t){throw console.log(e),a.wrapError(t,r)}else if(l(e))throw new r.intrinsics.TypeError("need primitive or callable, got "+e);return e},globalReservedProps:["globalThis","Infinity","NaN","undefined","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","AggregateError","Array","ArrayBuffer","Atomics","BigInt","BigInt64Array","BigUint64Array","Boolean","DataView","Date","Error","EvalError","FinalizationRegistry","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Number","Object","Promise","Proxy","RangeError","ReferenceError","RegExp","Set","SharedArrayBuffer","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakRef","WeakSet","Atomics","JSON","Math","Reflect","console"]});function v(r,e){e.define(r.globalObject,"ShadowRealm",{configurable:!0,writable:!0,value:m(r,e)})}function m(r,e){var t=r.intrinsics.eval("("+d.toString()+")")(r,e);return e.define(t,"__debug",{get:function(){return e._.debug},set:function(r){return e._.debug=r}}),t}function d(r,e){var t=r.intrinsics,n=t.Function,a=t.Promise,o=t.String,i=t.Symbol,s=t.TypeError,u=e.apply,l=e.define,c=e.dynamicImportPattern,f=e.dynamicImportReplacer,p=e.getWrappedValue,g=e.isObject,v=e.replace,m=e.wrapError,d=n.toString,h=function ShadowRealm(){if(!(this instanceof h))throw new s("Constructor requires a new operator");var t=e.createRealmRecord(r,e);l(this,"__realm",{value:t})},y=h.prototype,_=!0;return l(y,"evaluate",{configurable:_,writable:_,value:function evaluate(t){var a,o=g(this)?this.__realm:{};if(!o.intrinsics)throw new s("must be called on ShadowRealm object");if("string"!=typeof t)throw new s("evaluate expects a string");t=v(t,c,f);try{a=function evalWithCatch(r,t){r=v(r,c,f),r=u(d,n(r),[]),r='"use strict";undefined;try'+v(r,/[^{]+/,"")+"catch(e){throw{_:e}}",e.log(r);var a=t.globalObject;return a.eval=t.intrinsics,u(t.evalInContext,a,[r])}(t,o)}catch(e){throw m(e,r,_)}return p(r,a,o,e)}}),l(y,"importValue",{configurable:_,writable:_,value:function importValue(t,n){var i=g(this)?this.__realm:{};if(!i.intrinsics)throw new s("must be called on ShadowRealm object");if(t=o(t),"string"!=typeof n)throw new s("bindingName is not string");return new a((function(a,o){i.globalObject.__import(t).then((function(o){if(!(n in o))throw new s('"'+t+'" has no export named "'+n+'"');var u=p(r,o[n],i,e);a(u)})).catch((function(e){var t=m(e,r);o(t)}))}))}}),i&&i.toStringTag&&l(y,i.toStringTag,{configurable:_,value:"ShadowRealm"}),h}function h(r,e){var t,n=r.globalObject,a=r.intrinsics,o=e.apply,i=e.define,s=e.GLOBAL,u=a.Array.prototype.push,l=a.Object.create,c=a.Promise,f=a.Symbol,p=s.fetch,g=s.URL,v=c.all,m=c.prototype.then,d={};function h(r){var t=d[r];if(t)return t.promise;var n=p(r,{credentials:"same-origin"}).then((function(e){if(200===e.status)return e.text();throw{_:new a.TypeError("Failed to fetch dynamically imported module: "+r)}})).then((function(t){for(var n=e.transformEsmSyntax(t),a=n[0],i=n[1],s=[],l=0,f=i.length;l<f;++l){var p=new g(i[l],r).href;i[l]=p,o(u,s,[h(p)])}var d=o(v,c,[s]);return o(m,d,[function(e){for(var t=0,n=e.length;t<n;++t)y(i[t],e[t]);return'var __meta={url:"'+r+'"};'+a}])}),(function(r){if(r._)throw r._;throw new a[r.name](r.message)}));return t=d[r]={promise:n},n}function y(r,e){t=l(null),f&&f.toStringTag&&i(t,f.toStringTag,{value:"Module"}),n.eval(e);var a=d[r];return a.exports=t,t=void 0,a.exports}i(n,"__import",{value:function(r,e){void 0===e&&(e=s.location.href);var t=new g(r,e).href;return new c((function(r,e){var n=d[t];if(n&&n.exports)return r(n.exports);h(t).then((function(e){r(y(t,e))})).catch(e)}))}}),i(n,"__from",{value:function(r,e){var t=new g(r,e).href,n=d[t];if(n&&n.exports)return n.exports;throw new a.Error("Module does not exist ("+r+")")}}),i(n,"__export",{set:function(r){return e.assign(t,r)}}),i(n,"__default",{set:function(r){return t.default=r}})}function y(r){var e,t=window,n=t.Function,a=t.Object,o=t.Symbol,i=a.getOwnPropertyNames,s=r.apply,u=r.define,l=r.dynamicImportPattern,c=r.dynamicImportReplacer,f=r.replace,p={},g={};o&&o.unscopables&&u(g,o.unscopables,{value:a.seal(a.create(null))});for(var v=0,m=i(t);v<m.length;v++){var d=m[v];p[d]=t[d];var h=-1!==r.globalReservedProps.indexOf(d),y=a.getOwnPropertyDescriptor(t,d);"eval"===d?R():h&&u(g,d,y),y.configurable?delete t[d]:y.writable?t[d]=e:h||u(g,d,{value:e})}if(p.EventTarget)for(var _=0,b=i(p.EventTarget.prototype);_<b.length;_++){"constructor"!==(d=b[_])&&u(t,d,{value:e})}g.globalThis=g,g.Function=function createSafeFunction(){var e=n.toString,a=function Function(){var a=s(n,null,arguments),o=s(e,a,[]);o='with(this)return function(){"use strict";return '+(o=f(o,l,c))+"}()",r.log(o);var i=n(o),u=s(i,g,[]);return function(){var r=this===t?void 0:this;return s(u,r,arguments)}};return(a.prototype=n.prototype).constructor=a,a}();var w=n("with(this)return eval(arguments[0])"),S={intrinsics:p,globalObject:g,evalInContext:w};return r.defineShadowRealmCtor(S,r),r.addEsModuleHelpers(S,r),S;function R(){var e=!1,t=function(e){return e='"use strict";undefined;'+f(e,l,c),r.log(e),g.eval=p,s(w,g,[e])};u(g,"eval",{get:function(){return e?(e=!1,p.eval):t},set:function(r){e=r===p}})}}var _=[],b=[],w=/(^|[^.$])(\bimport\s*(\(|\/[/*]))/g,S="$1__$2",R=/([^\s,]+)\s+as\s+([^\s,]+)/g,E=[{p:RegExp("\\bexport\\b(\\s+((var|let|const)\\s+([^;]+)|(async\\s+)?function(\\s+|\\s*\\*\\s*)([^\\s(]+)|class\\s+([^\\s{]+)|default\\s+((async\\s+)?function(\\s+|\\s*\\*\\s*)([^\\s(]+)|class\\s+([^\\s{]+)|)?)|\\s*(\\*\\s*(as\\s+(\\S+)\\s+)?from\\s*(\"[^\"]+\"|'[^']+'|`[^`]+`)|{([^}]+)}(\\s*from\\s*(\"[^\"]+\"|'[^']+'|`[^`]+`))?))|\\bimport\\b(\\s*(({([^}]+)}\\s*|\\*\\s*as\\s+(\\S+)\\s+)from\\s*)?|\\s+([^{*\"'`]+)(\\s+from|\\s*,\\s*({([^}]+)}\\s*|\\*\\s*as\\s+(\\S+)\\s+)from)\\s*)(\"[^\"]+\"|'[^']+'|`[^`]+`)","g"),r:function(r,e,t,n,a,o,i,s,u,l,c,f,p,g,v,m,d,h,y,w,S,E,x,O,j,A,I,F,T,C,P,U){if(a){for(var $=0,W=a.split(",");$<W.length;$++){W[$].replace(/^\s*([^\s={}:]+)\s*($|=|})|[:{]\s*([^\s={}:]+)\s*($|=|})/,(function(r,e,t,n){return b.push(e||n),r}))}return t}if(s)return"__export={"+s+":"+s+"};"+t;if(u)return b.push(u),t;if(p)return"__default="+p+";"+l;if(g)return b.push(g),t;if(t)return t.replace(/^default/,"__default=");if(h)return _.push(h),d?"__export={"+d+":__from("+h+",__meta.url)}":"__export=__from("+h+",__meta.url)";if(S){_.push(S);var B=[];return y.replace(/([^\s,]+)(\s+as\s+([^\s,]+))?/g,(function(r,e,t,n){return B.push((n||e)+":m."+e),r})),";(function(){var m=__from("+S+",__meta.url);__export={"+B.join()+"}}())"}if(y)return"__export={"+y.replace(R,"$2:$1")+"}";if(U){_.push(U);var N="=__from("+U+",__meta.url)";return j?"const{"+j.replace(R,"$1:$2")+"}"+N:A?"var "+A+N:C?"const{"+C.replace(R,"$1:$2")+"}"+N+","+I+N+".default":P?"var "+P+N+","+I+"="+P+".default":I?"var "+I+N+".default":U}}},{p:/\bimport\.meta\b/g,r:"__meta"},{p:w,r:S}];var x=c({addEsModuleHelpers:function(r,e){r.intrinsics.eval("("+h.toString()+")")(r,e)},createRealmRecord:function(r,e){var t=r.intrinsics.document,n=t.createElement("iframe");return n.name="ShadowRealm",t.head.appendChild(n),n.contentWindow.eval("("+y.toString()+")")(e)},createShadowRealmCtor:m,defineShadowRealmCtor:v,dynamicImportPattern:w,dynamicImportReplacer:S,transformEsmSyntax:function(r){for(var e=0,t=E;e<t.length;e++){var n=t[e],a=n.p,o=n.r;r=r.replace(a,o)}if(b.length){for(var i=b.length-1;i>=0;--i)b[i]+=":"+b[i];r+=";__export={"+b.join()+"}",b.length=0}for(var s=[],u=(i=0,_.length);i<u;++i){var l=_[i];s.push(l.substring(1,l.length-1))}return _.length=0,[r,s]}},g);e.ShadowRealm||m({intrinsics:e},x),e.ShadowRealm||v({intrinsics:e,globalObject:e},x)}));
//# sourceMappingURL=polyfill.umd.js.map
